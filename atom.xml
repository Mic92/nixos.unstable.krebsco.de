<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Adventures in NixOS unstable</title><link href="http://nixos.unstable.krebsco.de/" rel="alternate"></link><link href="http://nixos.unstable.krebsco.de/atom.xml" rel="self"></link><id>http://nixos.unstable.krebsco.de/</id><updated>2016-08-09T21:15:00+02:00</updated><entry><title>stable@2016-06-11 to unstable@2016-07-20</title><link href="http://nixos.unstable.krebsco.de/stable2016-06-11-to-unstable2016-07-20.html" rel="alternate"></link><published>2016-08-09T21:15:00+02:00</published><author><name>makefu</name></author><id>tag:nixos.unstable.krebsco.de,2016-07-25:stable2016-06-11-to-unstable2016-07-20.html</id><summary type="html">&lt;p&gt;Accidentally updated from stable channel to unstable:
&lt;code&gt;0546a4a -&amp;gt; 125ffff&lt;/code&gt;&lt;/p&gt;
&lt;div class="section" id="new-problems-i-managed-to-solve"&gt;
&lt;h2&gt;new problems i managed to solve&lt;/h2&gt;
&lt;div class="section" id="xorg-does-not-accept-connections-from-system-users"&gt;
&lt;h3&gt;Xorg does not accept connections from system users&lt;/h3&gt;
&lt;p&gt;not sure how long it didn't work but &lt;code&gt;xhost&lt;/code&gt; fixes it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;services.xserver.displayManager.sessionCommands &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;
  &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;pkgs&lt;/span&gt;&lt;span class="p"&gt;.xorg.xhost&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/bin/xhost +local:
&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="msmtp-stopped-working"&gt;
&lt;h3&gt;msmtp stopped working&lt;/h3&gt;
&lt;p&gt;trying to start up msmtp results in:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Jul &lt;span class="m"&gt;27&lt;/span&gt; 09:07:35 omo audit&lt;span class="o"&gt;[&lt;/span&gt;5803&lt;span class="o"&gt;]&lt;/span&gt;: ANOM_ABEND &lt;span class="nv"&gt;auid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;9001&lt;/span&gt; &lt;span class="nv"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;9001&lt;/span&gt; &lt;span class="nv"&gt;gid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;100&lt;/span&gt; &lt;span class="nv"&gt;ses&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="nv"&gt;pid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;5803&lt;/span&gt; &lt;span class="nv"&gt;comm&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;msmtp&amp;quot;&lt;/span&gt; &lt;span class="nv"&gt;exe&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/nix/store/ic79467gar4ard15z3xwknxwa772gy9q-msmtp-1.6.4/bin/msmtp&amp;quot;&lt;/span&gt; &lt;span class="nv"&gt;sig&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;4
Jul &lt;span class="m"&gt;27&lt;/span&gt; 09:07:35 omo kernel: traps: msmtp&lt;span class="o"&gt;[&lt;/span&gt;5803&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="nb"&gt;trap&lt;/span&gt; invalid opcode ip:7fc95490e18e sp:7ffcf59b2448 error:0 in libgmp.so.10.3.0&lt;span class="o"&gt;[&lt;/span&gt;7fc9548d5000+8f000&lt;span class="o"&gt;]&lt;/span&gt;
Jul &lt;span class="m"&gt;27&lt;/span&gt; 09:07:35 omo kernel: audit: &lt;span class="nv"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1701&lt;/span&gt; audit&lt;span class="o"&gt;(&lt;/span&gt;1469603255.865:151&lt;span class="o"&gt;)&lt;/span&gt;: &lt;span class="nv"&gt;auid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;9001&lt;/span&gt; &lt;span class="nv"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;9001&lt;/span&gt; &lt;span class="nv"&gt;gid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;100&lt;/span&gt; &lt;span class="nv"&gt;ses&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="nv"&gt;pid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;5803&lt;/span&gt; &lt;span class="nv"&gt;comm&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;msmtp&amp;quot;&lt;/span&gt; &lt;span class="nv"&gt;exe&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/nix/store/ic79467gar4ard15z3xwknxwa772gy9q-msmtp-1.6.4/bin/msmtp&amp;quot;&lt;/span&gt; &lt;span class="nv"&gt;sig&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;4
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Just to finish sending my mail I installed old msmtp into user env:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;find /nix/store -name msmtpd -type f
nix-env -i /nix/store/pzfam2i2kpfdncz8yzyn5bkxq7fmin8z-msmtp-1.6.4/bin/msmtp
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="gpg-agent-stopped-working"&gt;
&lt;h3&gt;GPG agent stopped working&lt;/h3&gt;
&lt;p&gt;Seems like in gpg 2.1 write-env-file became obsolete:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gpg-agent&lt;span class="o"&gt;[&lt;/span&gt;14303&lt;span class="o"&gt;]&lt;/span&gt;: WARNING: &lt;span class="s2"&gt;&amp;quot;--write-env-file&amp;quot;&lt;/span&gt; is an obsolete option - it has no effect&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="solution"&gt;
&lt;h4&gt;Solution&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gd"&gt;--- a/makefu/2configs/zsh-user.nix&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/makefu/2configs/zsh-user.nix&lt;/span&gt;
&lt;span class="gu"&gt;@@ -22,15 +22,11 @@&lt;/span&gt;
&lt;span class="gd"&gt;-      # load gpg-agent&lt;/span&gt;
&lt;span class="gd"&gt;-      envfile=&amp;quot;$HOME/.gnupg/gpg-agent.env&amp;quot;&lt;/span&gt;
&lt;span class="gd"&gt;-      if [ -e &amp;quot;$envfile&amp;quot; ] &amp;amp;&amp;amp; kill -0 $(grep GPG_AGENT_INFO &amp;quot;$envfile&amp;quot; | cut -d: -f 2) 2&amp;gt;/dev/null; then&lt;/span&gt;
&lt;span class="gd"&gt;-        eval &amp;quot;$(cat &amp;quot;$envfile&amp;quot;)&amp;quot;&lt;/span&gt;
&lt;span class="gd"&gt;-      else&lt;/span&gt;
&lt;span class="gd"&gt;-        eval &amp;quot;$(${pkgs.gnupg}/bin/gpg-agent --daemon --enable-ssh-support --write-env-file &amp;quot;$envfile&amp;quot;)&amp;quot;&lt;/span&gt;
&lt;span class="gd"&gt;-      fi&lt;/span&gt;
&lt;span class="gd"&gt;-      export GPG_AGENT_INFO&lt;/span&gt;
&lt;span class="gd"&gt;-      export SSH_AUTH_SOCK&lt;/span&gt;
&lt;span class="gi"&gt;+      ${pkgs.gnupg}/bin/gpg-connect-agent updatestartuptty /bye &amp;gt;/dev/null&lt;/span&gt;
&lt;span class="gi"&gt;+      GPG_TTY=$(tty)&lt;/span&gt;
&lt;span class="gi"&gt;+      export GPG_TTY&lt;/span&gt;
&lt;span class="gi"&gt;+      unset SSH_AGENT_PID&lt;/span&gt;
&lt;span class="gi"&gt;+      export SSH_AUTH_SOCK=&amp;quot;/run/user/$UID/gnupg/S.gpg-agent.ssh&amp;quot;&lt;/span&gt;
      &amp;#39;&amp;#39;;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="touchpad-enabled-on-x220-but-in-retard-mode"&gt;
&lt;h3&gt;Touchpad enabled on X220 but in retard mode&lt;/h3&gt;
&lt;p&gt;I use the trackpoint instead, before it was disabled by default.&lt;/p&gt;
&lt;div class="section" id="id1"&gt;
&lt;h4&gt;Solution&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gd"&gt;--- a/makefu/2configs/hw/tp-x2x0.nix&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/makefu/2configs/hw/tp-x2x0.nix&lt;/span&gt;
&lt;span class="gu"&gt;@@ -12,6 +12,12 @@&lt;/span&gt;
&lt;span class="gi"&gt;+  # enable synaptics so we can easily disable the touchpad&lt;/span&gt;
&lt;span class="gi"&gt;+  #   enable the touchpad with `synclient TouchpadOff=0`&lt;/span&gt;
&lt;span class="gi"&gt;+  services.xserver.synaptics = {&lt;/span&gt;
&lt;span class="gi"&gt;+    enable = true;&lt;/span&gt;
&lt;span class="gi"&gt;+    additionalOptions = &amp;#39;&amp;#39;Option &amp;quot;TouchpadOff&amp;quot; &amp;quot;1&amp;quot;&amp;#39;&amp;#39;;&lt;/span&gt;
&lt;span class="gi"&gt;+  };&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="devpi-stopped-building"&gt;
&lt;h3&gt;Devpi stopped building&lt;/h3&gt;
&lt;p&gt;Tests are activated by default for python packages. For some reason my devpi
package contains failing tests, too lazy to investigate.&lt;/p&gt;
&lt;div class="section" id="workaround"&gt;
&lt;h4&gt;Workaround&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gd"&gt;--- a/makefu/5pkgs/devpi/default.nix&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/makefu/5pkgs/devpi/default.nix&lt;/span&gt;
&lt;span class="gu"&gt;@@ -8,7 +8,7 @@ let&lt;/span&gt;
      url = &amp;quot;https://pypi.python.org/packages/source/e/execnet/${name}.tar.gz&amp;quot;;
      sha256 = &amp;quot;1rpk1vyclhg911p3hql0m0nrpq7q7mysxnaaw6vs29cpa6kx8vgn&amp;quot;;
    };
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+    doCheck = false;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="deprecated-nixpkgs-options"&gt;
&lt;h3&gt;Deprecated nixpkgs options&lt;/h3&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;services.xserver.vaapiDrivers&lt;/tt&gt; became &lt;tt class="docutils literal"&gt;hardware.opengl.extraPackages&lt;/tt&gt;,
&lt;tt class="docutils literal"&gt;nix.useChroot&lt;/tt&gt; became &lt;tt class="docutils literal"&gt;nix.useSandbox&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;services.iodined.*&lt;/tt&gt; became &lt;tt class="docutils literal"&gt;services.iodined.server&lt;/tt&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gd"&gt;--- a/makefu/2configs/default.nix&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/makefu/2configs/default.nix&lt;/span&gt;
&lt;span class="gu"&gt;@@ -66,7 +66,7 @@&lt;/span&gt;
&lt;span class="gd"&gt;-  nix.useChroot = true;&lt;/span&gt;
&lt;span class="gi"&gt;+  nix.useSandbox = true;&lt;/span&gt;
&lt;span class="gd"&gt;--- a/makefu/2configs/hw/tp-x220.nix&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/makefu/2configs/hw/tp-x220.nix&lt;/span&gt;
&lt;span class="gu"&gt;@@ -8,10 +8,9 @@&lt;/span&gt;
&lt;span class="gd"&gt;-&lt;/span&gt;
&lt;span class="gi"&gt;+  hardware.opengl.extraPackages =  [ pkgs.vaapiIntel pkgs.vaapiVdpau ];&lt;/span&gt;
  services.xserver = {
    videoDriver = &amp;quot;intel&amp;quot;;
&lt;span class="gd"&gt;-    vaapiDrivers = [ pkgs.vaapiIntel pkgs.vaapiVdpau ];&lt;/span&gt;
&lt;span class="gd"&gt;--- a/makefu/2configs/iodined.nix&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/makefu/2configs/iodined.nix&lt;/span&gt;
&lt;span class="gu"&gt;@@ -8,9 +8,11 @@ in {&lt;/span&gt;

  services.iodined = {
    enable = true;
&lt;span class="gd"&gt;-    domain = domain;&lt;/span&gt;
&lt;span class="gd"&gt;-    ip = &amp;quot;172.16.10.1/24&amp;quot;;&lt;/span&gt;
&lt;span class="gd"&gt;-    extraConfig = &amp;quot;-P ${pw} -l ${config.krebs.build.host.nets.internet.ip4.addr}&amp;quot;;&lt;/span&gt;
&lt;span class="gi"&gt;+    server = {&lt;/span&gt;
&lt;span class="gi"&gt;+      domain = domain;&lt;/span&gt;
&lt;span class="gi"&gt;+      ip = &amp;quot;172.16.10.1/24&amp;quot;;&lt;/span&gt;
&lt;span class="gi"&gt;+      extraConfig = &amp;quot;-P ${pw} -l ${config.krebs.build.host.nets.internet.ip4.addr}&amp;quot;;&lt;/span&gt;
&lt;span class="gi"&gt;+    };&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="broken-stuff-i-will-fix-by-waiting-for-a-new-release"&gt;
&lt;h2&gt;broken stuff i will fix by waiting for a new release&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;Xorg takes 10 seconds to boot&lt;/strong&gt; -
I do not boot too often, will have this solved via enterprise-waiting.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Screen flickers when root user logs in&lt;/strong&gt; -
Redshift is now a systemd user service which results in redshift starting up
at connect. Will not do anything.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;systemd --user fails&lt;/strong&gt; -
see &lt;a class="reference external" href="https://github.com/NixOS/nixpkgs/issues/15653"&gt;https://github.com/NixOS/nixpkgs/issues/15653&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="solved-with-update"&gt;
&lt;h2&gt;solved with update&lt;/h2&gt;
&lt;p&gt;Some things actually get solved with the new rev:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;chromium does not use up all 4 CPUs when showing videos&lt;/li&gt;
&lt;li&gt;nixos module &lt;a class="reference external" href="https://github.com/NixOS/nixpkgs/blob/master/nixos/modules/security/acme.nix#L117"&gt;security.acme&lt;/a&gt; provides &lt;code&gt;preliminarySelfsigned&lt;/code&gt; for automated ssl certificate creation&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary><category term="stable-to-unstable"></category><category term="125ffff"></category><category term="0546a4a"></category></entry><entry><title>Blog Introduction</title><link href="http://nixos.unstable.krebsco.de/blog-introduction.html" rel="alternate"></link><published>2016-07-25T14:06:00+02:00</published><author><name>makefu</name></author><id>tag:nixos.unstable.krebsco.de,2016-07-21:blog-introduction.html</id><summary type="html">&lt;p&gt;I decided i will share my adventures through &lt;a class="reference external" href="https://nixos.org/"&gt;NixOS&lt;/a&gt; and
more specifically following either the &lt;a class="reference external" href="https://nixos.org/nixos/manual/index.html#sec-upgrading"&gt;NixOS Unstable Channel&lt;/a&gt; or the Latest NixOS Stable Channel.&lt;/p&gt;
&lt;p&gt;The Blog posts will contain the Git Hash and the time i updated. It will be mostly a short problem description and how (or how not) i fixed it all together with code blocks and links to extra descriptions. I will try to convince more people becoming contributors to this blog.&lt;/p&gt;
&lt;p&gt;The sources can be found in a dedicated &lt;a class="reference external" href="https://github.com/krebscode/nixos.unstable.krebsco.de"&gt;Github Repository&lt;/a&gt; ,the website gets deployed by &lt;a class="reference external" href="https://travis-ci.org/krebscode/nixos.unstable.krebsco.de/"&gt;Travis CI&lt;/a&gt; and delivered via the &lt;a class="reference external" href="https://pages.github.com/"&gt;Github Pages CDN&lt;/a&gt;&lt;/p&gt;
</summary><category term="nixos"></category><category term="unstable"></category><category term="stable"></category><category term="intro"></category></entry></feed>